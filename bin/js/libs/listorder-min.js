/* listorder version 1.0.3
* Copyright (c) 2012 Michel Bobillier aka Athos99 www.athos99.com
*
* GNU General Public License, version 3 (GPL-3.0) http://www.gnu.org/licenses/gpl-3.0.en.html
*
* Description:
*   listorder is a jQuery Plugin for ordered and filtered select option list. Can ordered and filter other list of type li or div
*   http://www.athos99.com/listorder
*
*   Usage : $("#idlist").listorder();
*           $("select").listorder( {filter:'asc'});
*           $("ul").listorder( {filter:'asc',child:'ul'});
*/
(function(d){function i(c){switch(c.settings.order){case "asc":c.savelist.sort(function(a,b){a=c.settings.childValue.call(a);b=c.settings.childValue.call(b);return d.isNumeric(a)&&d.isNumeric(b)?a-b:a<b?-1:a>b?1:0});break;case "desc":c.savelist.sort(function(a,b){b=c.settings.childValue.call(b);a=c.settings.childValue.call(a);return d.isNumeric(b)&&d.isNumeric(a)?b-a:b<a?-1:b>a?1:0});break;case "rand":c.savelist.sort(function(){return 0.5>Math.random()?1:-1})}}function g(c,a){var b=a.settings.filter.toLowerCase();
d.each(a.savelist,function(d,f){var g=!0;b.length&&(g=a.settings.filterExact?0===a.settings.childValue.call(f).toLowerCase().indexOf(b):-1!==a.settings.childValue.call(f).toLowerCase().indexOf(b));g?c.append(f):f.detach()})}function j(c){var a=c.data("listorder"),b=a.settings.filter;a.settings.filter="";g(c,a);a.settings.filter=b;c.children(a.settings.child).each(function(){d(this).attr("selected","selected")})}var h={init:function(c){return this.each(function(){var a={},b=d(this);a.settings=d.extend({order:"asc",
child:"option",childValue:function(){return this.text().toLowerCase()},filter:"",filterExact:!1,submitAll:!1},c);d.isNumeric(a.settings.filterExact)&&(a.settings.filterExact=parseInt(a.settings.filterExact,10));d.isNumeric(a.settings.submitAll)&&(a.settings.submitAll=parseInt(a.settings.submitAll,10));var e=[];b.children(a.settings.element).each(function(){e.push(d(this))});a.savelist=e;b.data("listorder",a);i(a);g(b,a);if(a.settings.submitAll)b.closest("form").on("submit",function(){j(b)})})},filter:function(c,
a){return this.each(function(){var b=d(this),e=b.data("listorder");void 0!==a&&(d.isNumeric(a)&&(a=parseInt(a,10)),e.settings.filterExact=a);e.settings.filter="string"===typeof c?c:"";g(b,e)})},selectAll:function(){return this.each(function(){j(d(this))})},unselectAll:function(){return this.each(function(){var c=d(this),a=c.data("listorder");d.each(a.savelist,function(){d(this).removeAttr("selected")});g(c,a)})},display:function(){return this.each(function(){var c=d(this),a=c.data("listorder");g(c,
a)})},exclude:function(c){return this.each(function(){var a=d(this),b=a.data("listorder"),e=[];if(void 0!==c){c.children(b.settings.child).each(function(){e[d(this).text()]=1});var f;for(f=0;f<b.savelist.length;)b.savelist[f].text()in e?(b.savelist.splice(f,1),d(a.children()[f]).detach()):f++}g(a,b)})},include:function(c){return this.each(function(){var a=d(this),b=a.data("listorder"),e=[];void 0!=c&&(d.each(b.savelist,function(){e[d(this).text()]=d(this)}),c.children(b.settings.child).each(function(){d(this).text()in
e||b.savelist.push(d(this).clone())}),i(b));g(a,b)})},order:function(c){return this.each(function(){var a=d(this),b=a.data("listorder");b.settings.order=c;i(b);g(a,b)})},add:function(c,a){return this.each(function(){var b=!0,e=d(this),f=e.data("listorder");a||d.each(f.savelist,function(){c.text()===d(this).text()&&(b=!1)});b&&f.savelist.push(c);i(f);g(e,f)})},remove:function(c){return this.each(function(){var a="text",b=d(this),e=b.data("listorder");"string"!=typeof c&&(a="object");for(var f=0;f<
e.savelist.length;)("object"==a?e.savelist[f][0]===c[0]:e.settings.childValue.call(e.savelist[f])===c)?(e.savelist[f].detach(),e.savelist.splice(f,1)):f++;g(b,e)})},duo:function(c){var a=d(this);a.data("listorder");c.data("listorder");a.on("click.listorder",function(){var b=d(this.item(this.selectedIndex));b.removeAttr("selected");a.listorder("remove",b)});c.on("click.listorder",function(){var b=d(this.item(this.selectedIndex));b.removeAttr("selected");b=b.clone();a.listorder("add",b)})},duoInclude:function(c){var a=
d(this);h.include.call(c,a);h.duo.call(a,c)},duoExclude:function(c){var a=d(this);a.data("listorder");a.data("listorder");h.exclude.call(c,a);a.on("click.listorder",function(){var b=d(this.item(this.selectedIndex));b.removeAttr("selected");a.listorder("remove",b);c.listorder("add",b)});c.on("click.listorder",function(){var b=d(this.item(this.selectedIndex));b.removeAttr("selected");c.listorder("remove",b);a.listorder("add",b)})},setChildValue:function(c){return this.each(function(){var a=d(this),
b=a.data("listorder");b.settings.childValue=c;i(b);g(a,b)})}};d.fn.listorder=function(c){if(h[c])return h[c].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof c||!c)return h.init.apply(this,arguments);d.error("Method "+c+" does not exist on jQuery.listorder");return!1}})(jQuery);